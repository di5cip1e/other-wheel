<h1>Double Wheel Spinner</h1>
<div id="wheelContainer" style="position:relative; width:500px; height:500px; margin:0 auto;">
  <!-- Big Wheel -->
  <div id="bigWheel" style="position:absolute; width:400px; height:400px; border-radius:50%; border:5px solid #333; overflow:hidden;">
    <!-- Wedges will be generated by JS -->
  </div>
  
  <!-- Small Wheel -->
  <div id="smallWheel" style="position:absolute; width:200px; height:200px; border-radius:50%; border:3px solid #555; top:100px; left:150px; overflow:hidden;">
    <!-- Wedges will be generated by JS -->
  </div>
  
  <!-- Needle -->
  <div id="needle" style="position:absolute; width:4px; height:50px; background:red; top:-20px; left:248px; transform-origin:bottom center; z-index:10;"></div>
</div>

<!-- Power Meter -->
<div style="margin:20px auto; text-align:center;">
  <h3>Power Meter</h3>
  <div id="meterContainer" style="position:relative; width:300px; height:30px; background:#ddd; border:1px solid #333; margin:10px auto;">
    <div id="meterIndicator" style="position:absolute; width:10px; height:30px; background:red; left:0; transition:left 0.1s;"></div>
  </div>
  <button id="spinBtn" onclick="startMeter()">Start Spin</button>
</div>

<!-- Wedge Editors -->
<div style="display:flex; justify-content:space-around; margin:20px auto; max-width:800px;">
  <div>
    <h3>Big Wheel Wedges:</h3>
    <div id="bigWheelInputs"></div>
  </div>
  <div>
    <h3>Small Wheel Wedges:</h3>
    <div id="smallWheelInputs"></div>
  </div>
</div>

<!-- Output -->
<p id="output" style="margin:1em auto; padding:0 1em; max-width:700px;"></p>

<!-- The line below makes it so if your device is in dark mode, then the default text color is switched to white, and the default background color is switch to black. -->
<style> html { color-scheme: light dark; } </style>

<script>
  // Configuration
  const bigWheelWedges = 8;
  const smallWheelWedges = 6;
  const wedgeColors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#ffbe0b', '#fb5607', '#8338ec', '#3a86ff', '#38b000'];
  
  // State
  let bigWheelAngle = 0;
  let smallWheelAngle = 0;
  let bigWheelSpeed = 0;
  let smallWheelSpeed = 0;
  let isSpinning = false;
  let meterValue = 50;
  let meterInterval = null;
  let spinInterval = null;
  let bigWheelTexts = Array(bigWheelWedges).fill().map((_, i) => `Big ${i+1}`);
  let smallWheelTexts = Array(smallWheelWedges).fill().map((_, i) => `Small ${i+1}`);
  
  // Initialize wheels
  function initWheels() {
    createWheel('bigWheel', bigWheelWedges, bigWheelTexts, wedgeColors);
    createWheel('smallWheel', smallWheelWedges, smallWheelTexts, wedgeColors);
    createWedgeInputs();
  }
  
  // Create a wheel with wedges
  function createWheel(wheelId, wedgeCount, texts, colors) {
    const wheel = document.getElementById(wheelId);
    wheel.innerHTML = '';
    const wedgeAngle = 360 / wedgeCount;
    
    for (let i = 0; i < wedgeCount; i++) {
      const wedge = document.createElement('div');
      wedge.style.position = 'absolute';
      wedge.style.width = '50%';
      wedge.style.height = '50%';
      wedge.style.left = '25%';
      wedge.style.top = '0';
      wedge.style.transformOrigin = 'bottom center';
      wedge.style.transform = `rotate(${i * wedgeAngle}deg)`;
      wedge.style.clipPath = 'polygon(0 100%, 50% 0, 100% 100%)';
      wedge.style.backgroundColor = colors[i % colors.length];
      
      const text = document.createElement('div');
      text.textContent = texts[i];
      text.style.position = 'absolute';
      text.style.width = '100%';
      text.style.textAlign = 'center';
      text.style.top = '70%';
      text.style.transform = 'rotate(90deg)';
      text.style.fontSize = '12px';
      text.style.color = 'white';
      text.style.textShadow = '1px 1px 1px black';
      
      wedge.appendChild(text);
      wheel.appendChild(wedge);
    }
  }
  
  // Create input fields for wedge texts
  function createWedgeInputs() {
    const bigInputs = document.getElementById('bigWheelInputs');
    const smallInputs = document.getElementById('smallWheelInputs');
    
    bigInputs.innerHTML = '';
    smallInputs.innerHTML = '';
    
    for (let i = 0; i < bigWheelWedges; i++) {
      const input = document.createElement('input');
      input.type = 'text';
      input.value = bigWheelTexts[i];
      input.style.display = 'block';
      input.style.margin = '5px';
      input.onchange = (e) => {
        bigWheelTexts[i] = e.target.value;
        createWheel('bigWheel', bigWheelWedges, bigWheelTexts, wedgeColors);
      };
      bigInputs.appendChild(input);
    }
    
    for (let i = 0; i < smallWheelWedges; i++) {
      const input = document.createElement('input');
      input.type = 'text';
      input.value = smallWheelTexts[i];
      input.style.display = 'block';
      input.style.margin = '5px';
      input.onchange = (e) => {
        smallWheelTexts[i] = e.target.value;
        createWheel('smallWheel', smallWheelWedges, smallWheelTexts, wedgeColors);
      };
      smallInputs.appendChild(input);
    }
  }
  
  // Start the meter animation
  function startMeter() {
    if (isSpinning) return;
    
    spinBtn.textContent = 'Stop Meter';
    spinBtn.onclick = stopMeter;
    
    meterInterval = setInterval(() => {
      // Random movement between 0 and 100
      meterValue = Math.floor(Math.random() * 100);
      document.getElementById('meterIndicator').style.left = `${meterValue * 2.9}px`;
    }, 100);
  }
  
  // Stop the meter and start spinning
  function stopMeter() {
    clearInterval(meterInterval);
    spinBtn.textContent = 'Spinning...';
    spinBtn.disabled = true;
    
    // Calculate spin power based on meter position (higher = faster spin)
    const power = meterValue / 100;
    bigWheelSpeed = power * 20; // Max speed of 20 degrees per frame
    smallWheelSpeed = Math.min(power * 15, 10); // Clutch caps at 10 degrees per frame
    
    isSpinning = true;
    spinInterval = setInterval(updateSpin, 50);
  }
  
  // Update wheel spinning
  function updateSpin() {
    if (!isSpinning) return;
    
    // Update wheel angles
    bigWheelAngle += bigWheelSpeed;
    smallWheelAngle += smallWheelSpeed;
    
    // Apply friction
    bigWheelSpeed *= 0.98;
    smallWheelSpeed *= 0.97;
    
    // Update wheel rotations
    document.getElementById('bigWheel').style.transform = `rotate(${bigWheelAngle}deg)`;
    document.getElementById('smallWheel').style.transform = `rotate(${smallWheelAngle}deg)`;
    
    // Stop spinning when speeds are very low
    if (Math.abs(bigWheelSpeed) < 0.1 && Math.abs(smallWheelSpeed) < 0.1) {
      clearInterval(spinInterval);
      isSpinning = false;
      spinBtn.textContent = 'Start Spin';
      spinBtn.disabled = false;
      determineResult();
    }
  }
  
  // Determine which wedge the needle points to
  function determineResult() {
    // Calculate normalized angles (0-360)
    const bigNormAngle = ((bigWheelAngle % 360) + 360) % 360;
    const smallNormAngle = ((smallWheelAngle % 360) + 360) % 360;
    
    // Calculate which wedge the needle is pointing to (needle at top)
    const bigWedgeSize = 360 / bigWheelWedges;
    const smallWedgeSize = 360 / smallWheelWedges;
    
    // Adjust for needle position (top center)
    const bigIndex = Math.floor(((360 - bigNormAngle + bigWedgeSize/2) % 360) / bigWedgeSize);
    const smallIndex = Math.floor(((360 - smallNormAngle + smallWedgeSize/2) % 360) / smallWedgeSize);
    
    // Display result
    output.textContent = `Result: Big Wheel - "${bigWheelTexts[bigIndex]}", Small Wheel - "${smallWheelTexts[smallIndex]}"`;
    
    // Reset power meter to initial position after each spin
    meterValue = 50;
    document.getElementById('meterIndicator').style.left = `${meterValue * 2.9}px`;
  }
  
  // Initialize on page load
  window.onload = initWheels;
</script>